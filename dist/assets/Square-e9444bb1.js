import{_ as J,r as _,c as z,o as Q,a as X,b as i,d as r,e as s,f as l,w as o,u as m,g as Y,F as B,h as V,i as E,t as c,j as S,E as D,k as Z,l as ee,m as te,n as le,p as ae,q as se,v as oe,s as ne,x as p,y as ie,z as re,A as q,B as ue,C as de,D as ce,G as _e,H as pe}from"./index-2680deca.js";const ve={class:"square-page"},fe={class:"square-container"},me={class:"square-header"},ge={class:"header-left"},he={class:"header-right"},ye={class:"image-grid-wrapper"},we={key:0,class:"image-grid"},ke=["onClick"],be={class:"img-wrapper"},$e={class:"img-placeholder"},xe={class:"img-tag"},Ee={class:"img-info"},Te={class:"filename-row"},Ce=["title"],Ie={class:"meta"},Me={class:"time"},ze={class:"size"},Be={key:1,class:"empty-state"},Ve={key:2,class:"login-guide"},Se={class:"guide-content"},De={class:"dialog-custom-header"},qe={style:{"font-weight":"bold"}},Ne={key:0,class:"preview-container"},Le={class:"image-box"},Ge={class:"link-group"},Ue={class:"link-label-text"},Fe={__name:"Square",setup(Re){const v=_(!1),g=_([]),f=_("all"),w=_(!1),u=_(null),T=_(!1),h=_(!1),k=()=>{T.value=window.innerWidth<=768},N=()=>{h.value=!!localStorage.getItem("admin_token")},C=async()=>{if(!v.value){v.value=!0;try{const[t,e]=await Promise.all([S.getImages("telegraph").catch(()=>({success:!1,data:[]})),S.getImages("r2").catch(()=>({success:!1,data:[]}))]);let n=[];t&&t.success&&(n=[...n,...t.data]),e&&e.success&&(n=[...n,...e.data]),n.sort(($,d)=>new Date(d.uploadTime)-new Date($.uploadTime)),g.value=n}catch{D.error("加载广场数据异常")}finally{v.value=!1}}},y=t=>{if(!t)return"";if(t.originalName)return t.originalName;if(t.filename&&t.filename.startsWith("file_"))return`TG分享_${t.filename.split(".")[0].slice(-4)}`;if(t.url){const e=t.url.split("/");return e[e.length-1]}return"未命名图片"},I=z(()=>{let t=g.value;return f.value!=="all"&&(t=t.filter(e=>e.storageType===f.value)),h.value?t:t.slice(0,10)}),L=z(()=>{if(!u.value)return[];const{url:t}=u.value,e=y(u.value);return[{label:"原始链接",value:t},{label:"Markdown",value:`![${e}](${t})`},{label:"HTML代码",value:`<img src="${t}" alt="${e}" />`},{label:"BBCode",value:`[img]${t}[/img]`}]}),b=t=>{f.value=t},G=t=>{u.value=t,w.value=!0},U=async(t,e)=>{await navigator.clipboard.writeText(t),D.success(`${e} 已复制`)},F=t=>{if(!t)return"";const e=new Date(t.replace(/-/g,"/"));return`${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`},R=t=>{if(!t)return"未知大小";const e=1024,n=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,n)).toFixed(1)+" "+["B","KB","MB","GB"][n]};return Q(()=>{k(),N(),window.addEventListener("resize",k),C()}),X(()=>window.removeEventListener("resize",k)),(t,e)=>{const n=Z,$=ee,d=te,H=le,M=de,A=ce,P=_e,W=ae,j=pe,K=se,O=oe;return i(),r("div",ve,[s("div",fe,[s("div",me,[s("div",ge,[l(n,{size:"32",color:"#409eff"},{default:o(()=>[l(m(ne))]),_:1}),e[5]||(e[5]=s("h1",{class:"page-title"},"图片广场",-1)),l($,{type:"info",class:"subtitle"},{default:o(()=>[p(c(h.value?"欢迎回来，探索社区全部精彩图片":"查看最近分享的 10 张精彩图片"),1)]),_:1})]),s("div",he,[l(H,null,{default:o(()=>[l(d,{type:f.value==="all"?"primary":"",onClick:e[0]||(e[0]=a=>b("all"))},{default:o(()=>[...e[6]||(e[6]=[p("全部",-1)])]),_:1},8,["type"]),l(d,{type:f.value==="telegraph"?"primary":"",onClick:e[1]||(e[1]=a=>b("telegraph"))},{default:o(()=>[...e[7]||(e[7]=[p("Telegraph",-1)])]),_:1},8,["type"]),l(d,{type:f.value==="r2"?"primary":"",onClick:e[2]||(e[2]=a=>b("r2"))},{default:o(()=>[...e[8]||(e[8]=[p("Cloudflare R2",-1)])]),_:1},8,["type"])]),_:1}),l(d,{icon:m(ie),circle:"",onClick:C,loading:v.value,style:{"margin-left":"15px"}},null,8,["icon","loading"])])]),Y((i(),r("div",ye,[I.value.length>0?(i(),r("div",we,[(i(!0),r(B,null,V(I.value,a=>(i(),r("div",{key:a.url,class:"image-card glass-card",onClick:x=>G(a)},[s("div",be,[l(M,{src:a.thumbnailUrl||a.url,fit:"cover",class:"main-img",lazy:""},{placeholder:o(()=>[s("div",$e,[l(n,{class:"is-loading"},{default:o(()=>[l(m(re))]),_:1})])]),error:o(()=>[...e[9]||(e[9]=[s("div",{class:"img-placeholder"},"加载失败",-1)])]),_:1},8,["src"]),s("div",xe,[l(A,{size:"small",type:a.storageType==="r2"?"warning":"success",effect:"dark"},{default:o(()=>[p(c(a.storageType==="r2"?"R2":"TG"),1)]),_:2},1032,["type"])])]),s("div",Ee,[s("div",Te,[l(n,{size:"14",class:"title-prefix-icon"},{default:o(()=>[l(m(q))]),_:1}),s("div",{class:"filename",title:a.originalName||a.filename},c(y(a)),9,Ce)]),s("div",Ie,[s("span",Me,c(F(a.uploadTime)),1),s("span",ze,c(R(a.size)),1)])])],8,ke))),128))])):v.value?E("",!0):(i(),r("div",Be,[l(P,{description:"暂时没有图片，快去上传吧"})])),!h.value&&g.value.length>10?(i(),r("div",Ve,[s("div",Se,[l(W,null,{default:o(()=>[l(n,null,{default:o(()=>[l(m(ue))]),_:1})]),_:1}),s("p",null,"登录后台可解锁查看全部 "+c(g.value.length)+" 张图片",1),l(d,{type:"primary",plain:"",round:"",onClick:e[3]||(e[3]=a=>t.$router.push("/login"))},{default:o(()=>[...e[10]||(e[10]=[p("立即登录",-1)])]),_:1})])])):E("",!0)])),[[O,v.value]])]),l(K,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),title:y(u.value),width:T.value?"95%":"650px","append-to-body":"",class:"square-dialog"},{header:o(()=>[s("div",De,[l(n,{size:"16",style:{"margin-right":"8px","vertical-align":"middle"}},{default:o(()=>[l(m(q))]),_:1}),s("span",qe,c(y(u.value)),1)])]),default:o(()=>[u.value?(i(),r("div",Ne,[s("div",Le,[l(M,{src:u.value.url,fit:"contain",class:"full-img","preview-src-list":[u.value.url]},null,8,["src","preview-src-list"])]),s("div",Ge,[(i(!0),r(B,null,V(L.value,a=>(i(),r("div",{class:"link-item",key:a.label},[s("label",Ue,c(a.label),1),l(j,{modelValue:a.value,"onUpdate:modelValue":x=>a.value=x,readonly:"",size:"default"},{append:o(()=>[l(d,{onClick:x=>U(a.value,a.label)},{default:o(()=>[...e[11]||(e[11]=[p("复制",-1)])]),_:1},8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])])):E("",!0)]),_:1},8,["modelValue","title","width"])])}}},Ae=J(Fe,[["__scopeId","data-v-9307f741"]]);export{Ae as default};
