import{_ as J,r as _,c as B,o as Q,a as X,b as i,d as r,e as o,f as l,w as n,u as f,g as Y,F as S,h as V,i as $,t as u,j as D,E,k as Z,l as ee,m as te,n as ae,p as le,q as se,v as oe,s as ne,x as p,y as ie,z as re,A as q,B as de,C as ce,D as ue,G as _e,H as pe}from"./index-21464373.js";const ve={class:"square-page"},me={class:"square-container"},fe={class:"square-header"},ge={class:"header-left"},he={class:"title-content"},ye={class:"header-right"},we={class:"image-grid-wrapper"},ke={key:0,class:"image-grid"},be=["onClick"],xe={class:"img-wrapper"},Ce={class:"img-placeholder"},$e={class:"img-tag"},Ee={class:"img-info"},Te={class:"filename-row"},Ie=["title"],Me={class:"meta"},ze={class:"time"},Be={class:"size"},Se={key:1,class:"empty-state"},Ve={key:2,class:"login-guide"},De={class:"guide-content"},qe={class:"dialog-custom-header"},Ne={class:"dialog-header-text"},Le={key:0,class:"preview-container"},Ge={class:"image-box"},Ue={class:"link-group"},Fe={class:"link-label-text"},Re={__name:"Square",setup(Ae){const v=_(!1),g=_([]),m=_("all"),y=_(!1),d=_(null),T=_(!1),h=_(!1),w=()=>{T.value=window.innerWidth<=768},N=()=>{h.value=!!localStorage.getItem("admin_token")},I=async()=>{if(!v.value){v.value=!0;try{const[t,e]=await Promise.all([D.getImages("telegraph").catch(()=>({success:!1,data:[]})),D.getImages("r2").catch(()=>({success:!1,data:[]}))]);let a=[];t&&t.success&&(a=[...a,...t.data]),e&&e.success&&(a=[...a,...e.data]),a.sort((x,c)=>new Date(c.uploadTime)-new Date(x.uploadTime)),g.value=a}catch{E.error("加载广场数据异常")}finally{v.value=!1}}},k=t=>{if(!t)return"";if(t.originalName)return t.originalName;if(t.filename&&t.filename.startsWith("file_"))return`TG分享_${t.filename.split(".")[0].slice(-4)}`;if(t.url){const e=t.url.split("/");return e[e.length-1]}return"未命名图片"},M=B(()=>{let t=g.value;return m.value!=="all"&&(t=t.filter(e=>e.storageType===m.value)),h.value?t:t.slice(0,10)}),L=B(()=>{if(!d.value)return[];const{url:t}=d.value,e=k(d.value);return[{label:"原始链接",value:t},{label:"Markdown",value:`![${e}](${t})`},{label:"HTML代码",value:`<img src="${t}" alt="${e}" />`},{label:"BBCode",value:`[img]${t}[/img]`}]}),b=t=>{m.value=t},G=t=>{d.value=t,y.value=!0},U=async(t,e)=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(t);else{const a=document.createElement("textarea");a.value=t,a.style.position="fixed",a.style.left="-9999px",a.style.top="0",document.body.appendChild(a),a.focus(),a.select(),document.execCommand("copy"),document.body.removeChild(a)}E.success(`${e} 已复制`)}catch{E.error("复制失败，请手动选取")}},F=t=>{if(!t)return"";const e=new Date(t.replace(/-/g,"/"));return`${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`},R=t=>{if(!t)return"未知大小";const e=1024,a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+["B","KB","MB","GB"][a]};return Q(()=>{w(),N(),window.addEventListener("resize",w),I()}),X(()=>{window.removeEventListener("resize",w)}),(t,e)=>{const a=Z,x=ee,c=te,A=ae,z=ce,H=ue,P=_e,W=le,j=pe,K=se,O=oe;return i(),r("div",ve,[o("div",me,[o("div",fe,[o("div",ge,[l(a,{size:"32",color:"#409eff"},{default:n(()=>[l(f(ne))]),_:1}),o("div",he,[e[5]||(e[5]=o("h1",{class:"page-title"},"图片广场",-1)),l(x,{type:"info",class:"subtitle"},{default:n(()=>[p(u(h.value?"欢迎回来，探索社区全部精彩图片":"查看最近分享的 10 张精彩图片"),1)]),_:1})])]),o("div",ye,[l(A,null,{default:n(()=>[l(c,{type:m.value==="all"?"primary":"",onClick:e[0]||(e[0]=s=>b("all"))},{default:n(()=>[...e[6]||(e[6]=[p("全部",-1)])]),_:1},8,["type"]),l(c,{type:m.value==="telegraph"?"primary":"",onClick:e[1]||(e[1]=s=>b("telegraph"))},{default:n(()=>[...e[7]||(e[7]=[p("Telegraph",-1)])]),_:1},8,["type"]),l(c,{type:m.value==="r2"?"primary":"",onClick:e[2]||(e[2]=s=>b("r2"))},{default:n(()=>[...e[8]||(e[8]=[p("Cloudflare R2",-1)])]),_:1},8,["type"])]),_:1}),l(c,{icon:f(ie),circle:"",onClick:I,loading:v.value,style:{"margin-left":"15px"}},null,8,["icon","loading"])])]),Y((i(),r("div",we,[M.value.length>0?(i(),r("div",ke,[(i(!0),r(S,null,V(M.value,s=>(i(),r("div",{key:s.url,class:"image-card glass-card",onClick:C=>G(s)},[o("div",xe,[l(z,{src:s.thumbnailUrl||s.url,fit:"cover",class:"main-img",lazy:""},{placeholder:n(()=>[o("div",Ce,[l(a,{class:"is-loading"},{default:n(()=>[l(f(re))]),_:1})])]),error:n(()=>[...e[9]||(e[9]=[o("div",{class:"img-placeholder"},"加载失败",-1)])]),_:1},8,["src"]),o("div",$e,[l(H,{size:"small",type:s.storageType==="r2"?"warning":"success",effect:"dark"},{default:n(()=>[p(u(s.storageType==="r2"?"R2":"TG"),1)]),_:2},1032,["type"])])]),o("div",Ee,[o("div",Te,[l(a,{size:"14",class:"title-prefix-icon"},{default:n(()=>[l(f(q))]),_:1}),o("div",{class:"filename",title:s.originalName||s.filename},u(k(s)),9,Ie)]),o("div",Me,[o("span",ze,u(F(s.uploadTime)),1),o("span",Be,u(R(s.size)),1)])])],8,be))),128))])):v.value?$("",!0):(i(),r("div",Se,[l(P,{description:"暂时没有图片，快去上传吧"})])),!h.value&&g.value.length>10?(i(),r("div",Ve,[o("div",De,[l(W,null,{default:n(()=>[l(a,null,{default:n(()=>[l(f(de))]),_:1})]),_:1}),o("p",null,"登录后台可解锁查看全部 "+u(g.value.length)+" 张图片",1),l(c,{type:"primary",plain:"",round:"",onClick:e[3]||(e[3]=s=>t.$router.push("/login"))},{default:n(()=>[...e[10]||(e[10]=[p("立即登录",-1)])]),_:1})])])):$("",!0)])),[[O,v.value]])]),l(K,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=s=>y.value=s),width:T.value?"95%":"650px","append-to-body":"",class:"square-dialog"},{header:n(()=>[o("div",qe,[l(a,{size:"18",class:"dialog-header-icon"},{default:n(()=>[l(f(q))]),_:1}),o("span",Ne,u(k(d.value)),1)])]),default:n(()=>[d.value?(i(),r("div",Le,[o("div",Ge,[l(z,{src:d.value.url,fit:"contain",class:"full-img","preview-src-list":[d.value.url],"preview-teleported":""},null,8,["src","preview-src-list"])]),o("div",Ue,[(i(!0),r(S,null,V(L.value,s=>(i(),r("div",{class:"link-item",key:s.label},[o("label",Fe,u(s.label),1),l(j,{modelValue:s.value,"onUpdate:modelValue":C=>s.value=C,readonly:"",size:"default"},{append:n(()=>[l(c,{type:"primary",onClick:C=>U(s.value,s.label)},{default:n(()=>[...e[11]||(e[11]=[p("复制",-1)])]),_:1},8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])])):$("",!0)]),_:1},8,["modelValue","width"])])}}},Pe=J(Re,[["__scopeId","data-v-cc574d1a"]]);export{Pe as default};
